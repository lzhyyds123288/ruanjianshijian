<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>体育用品销售系统 - 购物车</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/layui-src/dist/css/layui.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <style>
        .layui-card { margin: 15px; }
        .cart-item { border-bottom: 1px dashed #eee; padding: 15px 0; }
        .cart-item:last-child { border-bottom: none; }
        .cart-img { width: 80px; height: 80px; margin-right: 15px; }
        .cart-img img { width: 100%; height: 100%; object-fit: cover; }
        .cart-info { flex: 1; }
        .cart-price { width: 100px; text-align: center; }
        .cart-quantity { width: 150px; text-align: center; }
        .cart-total { width: 120px; text-align: center; font-weight: bold; }
        .cart-action { width: 80px; text-align: center; }
        .quantity-btn { width: 28px; height: 28px; line-height: 28px; text-align: center; border: 1px solid #ccc; display: inline-block; cursor: pointer; }
        .quantity-input { width: 50px; height: 28px; text-align: center; border-top: 1px solid #ccc; border-bottom: 1px solid #ccc; display: inline-block; }
        .cart-footer { padding: 15px; background: #f9f9f9; margin-top: 15px; }
        .empty-cart { text-align: center; padding: 50px 0; color: #999; }
        .empty-cart i { font-size: 60px; margin-bottom: 20px; color: #ccc; }
    </style>
</head>
<body>
    <!-- 登录检查 -->
    <script>if (!localStorage.getItem('currentUser')) window.location.href = 'login.html';</script>

    <div class="layui-layout layui-layout-admin">
        <!-- 头部导航 -->
        <div class="layui-header">
            <div class="layui-logo"><i class="fa fa-futbol-o"></i> 体育用品销售系统</div>
            <ul class="layui-nav layui-layout-left">
                <li class="layui-nav-item"><a href="index.html">商品管理</a></li>
                <li class="layui-nav-item layui-this"><a href="cart.html">购物车</a></li>
                <li class="layui-nav-item"><a href="orders.html">我的订单</a></li>
            </ul>
            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item">
                    <a href="javascript:;"><img src="https://picsum.photos/id/1005/200/200" class="layui-nav-img"><span id="username">用户名</span></a>
                    <dl class="layui-nav-child"><dd><a href="javascript:;" id="logout">退出登录</a></dd></dl>
                </li>
            </ul>
        </div>

        <!-- 侧边栏 -->
        <div class="layui-side">
            <div class="layui-side-scroll">
                <ul class="layui-nav layui-nav-tree">
                    <li class="layui-nav-item">
                        <a href="javascript:;">商品管理</a>
                        <dl class="layui-nav-child"><dd><a href="index.html">商品列表</a></dd></dl>
                    </li>
                    <li class="layui-nav-item layui-this">
                        <a href="javascript:;">订单管理</a>
                        <dl class="layui-nav-child">
                            <dd class="layui-this"><a href="cart.html">购物车</a></dd>
                            <dd><a href="orders.html">我的订单</a></dd>
                        </dl>
                    </li>
                </ul>
            </div>
        </div>
		
        <!-- 主内容区 -->
        <div class="layui-body" style="padding: 15px;">
            <div class="layui-card">
                <div class="layui-card-header">
                    <h2>我的购物车</h2>
                </div>
                <div class="layui-card-body">
                    <div id="cartList">
                        <!-- 购物车内容将动态生成 -->
                    </div>
                    
                    <div class="cart-footer">
                        <div style="float: right;">
                            <span style="font-size: 16px; margin-right: 20px;">
                                合计：<span id="totalAmount" style="color: #ff4d4f; font-weight: bold;">¥0.00</span>
                            </span>
                            <button class="layui-btn layui-btn-danger" id="checkoutBtn">结算</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 页脚 -->
        <div class="layui-footer">© 体育用品销售系统 - 版权所有</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/layui-src/dist/layui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script>
        layui.use(['layer'],function(){
			const layer=layui.layer
			//加载用户信息
			function loadUserInfo(){
				const user=JSON.parse(localStorage.getItem('currentUser')||'[]')
				$('#username').text(user.username||'用户')
			}
			//退出登录
			$('#logout').click(()=>{
				localStorage.removeItem('currentUser')
				window.location.href='login.html'
			})
			//购物车数据操作
			const getCart=()=>JSON.parse(localStorage.getItem('cart')||'[]')
			const saveCart=(data)=>localStorage.setItem('cart',JSON.stringify(data))
			//计算总价
			function calculateTotal(){
				const cart=getCart()
				const total=cart.reduce((sum,item)=>sum+(item.price*item.quantity),0)
				$('#totalAmount').text(`￥${total.toFixed(2)}`)
				return total
			}
			//渲染购物车
			function renderCart(){
				const cart=getCart()
				const cartList=$('#cartList').empty()
				if(!cart.length){
					return cartList.html(`
					<div class="empty-cart">
				         <i class="fa fa-shopping-cart"></i>
						 <p>您的购物车是空的</p>
						 <p><a href="index.html" class="layui-btn layui-btn-primary">请购物</a></p>
					</div>
					`)
				}
				cart.forEach(item=>{
					const itemTotal=(item.price*item.quantity).toFixed(2)
					cartList.append(`
					<div class="cart-item" data-id="${item.id}">
					    <div style="display: flex; align-items: center;">
						    <div class="cart-img">
							    <img src="${item.imageUrl}" alt="${item.name}">
						    </div>
							<div class="cart-info">
							    <h4>${item.name}</h4>
							</div>
							<div class="cart-price">￥${item.price.toFixed(2)}</div>
							<div class="cart-quantity">
							    <span class="quantity-btn minus-btn" data-id="${item.id}">-</span>
								<span class="quantity-input">${item.quantity}</span>
								<span class="quantity-btn plus-btn" data-id="${item.id}">+</span>
							</div>
							<div class="cart-total">￥${itemTotal}</div>
							<div class="cart-action">
							     <button class="layui-btn layui-btn-danger layui-btn-sm delete-btn" data-id="${item.id}">
								      <i class="fa fa-trash-o"></i>删除
								</button>
							</div>
						</div>
					</div>
					`)
				})
				calculateTotal()
			}
			//减少数量
			$(document).on('click','.minus-btn',function(){
				const id=$(this).data('id')
				const cart=getCart()
				const item=cart.find(i=>i.id==id)
				if(item.quantity>1){
					item.quantity--
				}else{
					if(confirm('确定要从购物车中移除该商品?')){
						saveCart(cart.filter(i=>i.id!=id))
						renderCart()
						return
					}
				}
				saveCart(cart)
				renderCart()
			})
			//增加数量
			$(document).on('click','.plus-btn',function(){
				const id=$(this).data('id')
				const cart=getCart()
				const item=cart.find(i=>i.id==id)
				item.quantity++
				saveCart(cart)
				renderCart()
			})
			//删除商品
			$(document).on('click','.delete-btn',function(){
				const id=$(this).data('id')
				saveCart(getCart().filter(i=>i.id!=id))
				renderCart()
				layer.msg('已从购物车中移除')
			})
			//结算
			$('#checkoutBtn').click(function(){
				const cart=getCart()
				if(!cart.length){
					return layer.msg('购物车为空，无法结算',{icon:2})
				}
				//创建订单
				const orders=JSON.parse(localStorage.getItem('orders')||'[]')
				const orderId=Date.now()
				const totalAmount=calculateTotal()
				orders.push({
					id:orderId,
					createTime:new Date().toLocaleString(),
					items:cart,
					totalAmount:totalAmount,
					status:'待付款'
				})
				//保存订单并清空购物车
				localStorage.setItem('orders',JSON.stringify(orders))
				localStorage.removeItem('cart')
				layer.msg('下单成功',{icon:1},()=>{
					window.location.href="orders.html"
				})
			})
			loadUserInfo()
			renderCart()
		})
    </script>
</body>
</html>
